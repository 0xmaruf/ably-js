<!DOCTYPE html>
<html>
<head>
<script type="text/javascript">

/*
 Copyright 2015, Ably

 Ably JavaScript Library v0.8.8
 https://github.com/ably/ably-js

 Ably Realtime Messaging
 https://www.ably.io

 Released under the Apache Licence v2.0
*/
(function(){var z=window.Ably=this,h={internetUpUrlWithoutExtension:"https://internet-up.ably-realtime.com/is-the-internet-up",httpTransports:["xhr","iframe","jsonp"],transports:["web_socket","xhr","iframe","jsonp"],minified:!function(){}.name},A=function(){function a(){}a.addListener=function(a,b,e){a.addEventListener?a.addEventListener(b,e,!1):a.attachEvent("on"+b,function(){e.apply(a,arguments)})};a.removeListener=function(a,b,e){a.removeEventListener?a.removeEventListener(b,e,!1):a.detachEvent("on"+
b,function(){e.apply(a,arguments)})};a.addMessageListener=function(g,b){a.addListener(g,"message",b)};a.removeMessageListener=function(g,b){a.removeListener(g,"message",b)};a.addUnloadListener=function(g){a.addListener(window,"unload",g)};return a}();h.protocolVersion=1;h.ENVIRONMENT="";h.HOST="rest.ably.io";h.WS_HOST="realtime.ably.io";h.FALLBACK_HOSTS=["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"];h.PORT=80;h.TLS_PORT=443;h.TIMEOUTS=
{disconnectedRetryTimeout:15E3,suspendedRetryTimeout:3E4,httpRequestTimeout:15E3,connectionStateTtl:6E4,realtimeRequestTimeout:1E4,recvTimeout:9E4,connectionPersistTimeout:15E3};h.httpMaxRetryCount=3;h.version="0.8.8";h.getHost=function(a,g,b){return g=b?g==a.host&&a.wsHost||g||a.wsHost:g||a.host};h.getPort=function(a,g){return g||a.tls?a.tlsPort:a.port};h.getHttpScheme=function(a){return a.tls?"https://":"http://"};h.getHosts=function(a){var g=[a.host],b=a.fallbackHosts;a="undefined"!==typeof a.httpMaxRetryCount?
a.httpMaxRetryCount:h.httpMaxRetryCount;b&&(g=g.concat(b.slice(0,a)));return g};h.normaliseOptions=function(a){if(a.host)a.wsHost=a.wsHost||a.host;else{var g=a.environment&&String(a.environment).toLowerCase()||h.ENVIRONMENT,b=!g||"production"===g;a.host=b?h.HOST:g+"-"+h.HOST;a.wsHost=b?h.WS_HOST:g+"-"+h.WS_HOST;a.fallbackHosts=b?h.FALLBACK_HOSTS:a.fallbackHosts}a.port=a.port||h.PORT;a.tlsPort=a.tlsPort||h.TLS_PORT;"tls"in a||(a.tls=!0);a.timeouts={};for(var e in h.TIMEOUTS)a.timeouts[e]=a[e]||h.TIMEOUTS[e];
return a};var C=function(){function a(){this.any=[];this.events={};this.anyOnce=[];this.eventsOnce={}}a.prototype.on=function(a,b){1==arguments.length&&"function"==typeof a?this.any.push(a):null===a?this.any.push(b):(this.events[a]||(this.events[a]=[])).push(b)};a.prototype.off=function(a,b){if(0==arguments.length)this.any=[],this.events={},this.anyOnce=[],this.eventsOnce={};else{1==arguments.length&&"function"==typeof a&&(b=a,a=null);var e,d=-1;if(null===a)if(b){if(!(e=this.any)||-1==(d=n.arrIndexOf(e,
b)))if(e=this.anyOnce)d=n.arrIndexOf(e,b);-1<d&&e.splice(d,1)}else this.any=[],this.anyOnce=[];else if(b){d=-1;if(!(e=this.events[a])||-1==(d=n.arrIndexOf(e,b)))if(e=this.eventsOnce[a])d=n.arrIndexOf(e,b);-1<d&&e.splice(d,1)}else delete this.events[a],delete this.eventsOnce[a]}};a.prototype.listeners=function(a){if(a){var b=this.events[a]||[];this.eventsOnce[a]&&Array.prototype.push.apply(b,this.eventsOnce[a]);return b.length?b:null}return this.any.length?this.any:null};a.prototype.emit=function(a){function b(a){try{a.apply(d,
e)}catch(c){throw l.logAction(l.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+c+"; stack = "+c.stack),c;}}var e=Array.prototype.slice.call(arguments,1),d={event:a};if(this.anyOnce.length){var c=this.anyOnce;this.anyOnce=[];for(var f=0;f<c.length;f++)b(c[f])}for(f=0;f<this.any.length;f++)this.any[f].apply(d,e);if(c=this.eventsOnce[a])for(delete this.eventsOnce[a],f=0;f<c.length;f++)b(c[f]);if(c=this.events[a])for(f=0;f<c.length;f++)b(c[f])};a.prototype.once=function(a,b){1==arguments.length&&
"function"==typeof a?this.anyOnce.push(a):null===a?this.anyOnce.push(b):(this.eventsOnce[a]||(this.eventsOnce[a]=[])).push(b)};return a}(),l=function(){function a(a){}var g=2,b=console&&function(){console.log.apply(console,arguments)};a.LOG_NONE=0;a.LOG_ERROR=1;a.LOG_MAJOR=2;a.LOG_MINOR=3;a.LOG_MICRO=4;a.LOG_DEFAULT=2;a.LOG_DEBUG=4;a.logAction=function(e,d,c){a.shouldLog(e)&&b("Ably: "+d+": "+c)};a.shouldLog=function(a){return a<=g};a.setLog=function(a,d){void 0!==a&&(g=a);void 0!==d&&(b=d)};return a}(),
D=function(){return function(a){a=a||[];var g=function(){for(var b=0;b<a.length;b++){var e=a[b];try{e.apply(null,arguments)}catch(d){}}};g.push=function(){Array.prototype.push.apply(a,arguments)};return g}}(),n=function(){function a(){}var g="object"==typeof window;a.mixin=function(a,d){for(var c in d)d.hasOwnProperty(c)&&(a[c]=d[c]);return a};a.copy=function(e){return a.mixin({},e)};a.isArray=function(a){return"[object Array]"==Object.prototype.toString.call(a)};a.isObject=function(a){return"[object Object]"==
Object.prototype.toString.call(a)};a.isEmpty=function(a){for(var d in a)return!1;return!0};a.shallowClone=function(a){var d={},c;for(c in a)d[c]=a[c];return d};a.prototypicalClone=function(e,d){function c(){}c.prototype=e;var b=new c;d&&a.mixin(b,d);return b};a.inherits=function(e,d){e.super_=d;e.prototype=a.prototypicalClone(d.prototype,{constructor:e})};a.containsValue=function(a,d){for(var c in a)if(a[c]==d)return!0;return!1};a.intersect=function(e,d){return a.isArray(d)?a.arrIntersect(e,d):a.arrIntersectOb(e,
d)};a.isArray=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};a.arrIntersect=function(e,d){for(var c=[],b=0;b<e.length;b++){var g=e[b];-1!=a.arrIndexOf(d,g)&&c.push(g)}return c};a.arrIntersectOb=function(a,d){for(var c=[],b=0;b<a.length;b++){var g=a[b];g in d&&c.push(g)}return c};a.arrSubtract=function(e,d){for(var c=[],b=0;b<e.length;b++){var g=e[b];-1==a.arrIndexOf(d,g)&&c.push(g)}return c};a.arrIndexOf=Array.prototype.indexOf?function(a,d,b){return a.indexOf(d,
b)}:function(a,d,b){b=b||0;for(var f=a.length;b<f;b++)if(a[b]===d)return b;return-1};a.arrIn=function(b,d){return-1!==a.arrIndexOf(b,d)};a.arrDeleteValue=function(b,d){var c=a.arrIndexOf(b,d),f=-1!=c;f&&b.splice(c,1);return f};a.keysArray=function(a,b){var c=[],f;for(f in a)b&&!a.hasOwnProperty(f)||c.push(f);return c.length?c:void 0};a.valuesArray=function(a,b){var c=[],f;for(f in a)b&&!a.hasOwnProperty(f)||c.push(a[f]);return c.length?c:void 0};a.nextTick=g?function(a){setTimeout(a,0)}:process.nextTick;
var b={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};a.defaultGetHeaders=function(a){a=a||"json";return{accept:"json"===a?b.json:b[a]+","+b.json}};a.defaultPostHeaders=function(a){a=a||"json";return{accept:"json"===a?b.json:b[a]+","+b.json,"content-type":"json"===a?b.json:b[a]}};a.arrRandomElement=function(a){return a.splice(Math.floor(Math.random()*a.length))};a.toQueryString=function(a){var b=[];if(a)for(var c in a)b.push(encodeURIComponent(c)+
"="+encodeURIComponent(a[c]));return b.length?"?"+b.join("&"):""};a.parseQueryString=function(a){for(var b,c=/([^?&=]+)=?([^&]*)/g,f={};b=c.exec(a);)f[decodeURIComponent(b[1])]=decodeURIComponent(b[2]);return f};a.inspect=function(a){return JSON.stringify(a)};a.inspectError=function(b){return b&&"ErrorInfo"==b.constructor.name?b.toString():a.inspect(b)};return a}(),x=function(){function a(){this.presence=this.messages=this.msgSerial=this.channelSerial=this.channel=this.connectionSerial=this.connectionKey=
this.connectionId=this.error=this.count=this.timestamp=this.id=this.flags=this.action=void 0}function g(a){var b=[];if(a)for(var f=0;f<a.length;f++)b.push(a[f].toString());return"[ "+b.join(", ")+" ]"}var b="object"==typeof window?window.Ably.msgpack:(void 0)("msgpack-js");a.Action={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16};a.ActionName=[];Object.keys(a.Action).forEach(function(b){a.ActionName[a.Action[b]]=
b});a.Flag={HAS_PRESENCE:0,HAS_BACKLOG:1};a.encode=function(a,c){return"msgpack"==c?b.encode(a,!0):JSON.stringify(a)};a.decode=function(d,c){var f="msgpack"==c?b.decode(d):JSON.parse(String(d));return a.fromDecoded(f)};a.fromDecoded=function(b){var c=b.error;c&&(b.error=ErrorInfo.fromValues(c));var f=b.messages;if(f)for(c=0;c<f.length;c++)f[c]=Message.fromDecoded(f[c]);if(f=b.presence)for(c=0;c<f.length;c++)f[c]=PresenceMessage.fromDecoded(f[c]);return n.mixin(new a,b)};a.fromValues=function(b){return n.mixin(new a,
b)};var e="id channel channelSerial connectionId connectionKey connectionSerial count flags messageSerial timestamp".split(" ");a.stringify=function(b){var c="[ProtocolMessage";void 0!==b.action&&(c+="; action="+a.ActionName[b.action]||b.action);for(var f,h=0;h<e.length;h++)f=e[h],void 0!==b[f]&&(c+="; "+f+"="+b[f]);b.messages&&(c+="; messages="+g(Message.fromValuesArray(b.messages)));b.presence&&(c+="; presence="+g(PresenceMessage.fromValuesArray(b.presence)));b.error&&(c+="; error="+ErrorInfo.fromValues(b.error).toString());
return c+"]"};return a}(),y=function(){function a(){for(var a in f)f[a].dispose()}function g(){return window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?r=!0:B&&document.domain&&"https:"==window.location.protocol?!0:!1}function b(a,b,d,e,k,g){C.call(this);d=d||{};d.rnd=String(Math.random()).substr(2);var v,h;if(h=B)h=v=(v=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/))&&Number(v[1]);h&&10===v&&!d.envelope&&(d.envelope="json");this.uri=a+n.toQueryString(d);this.headers=b||{};this.body=
e;this.requestMode=k;this.timeouts=g;this.requestComplete=!1;f[this.id=String(++c)]=this}function e(a,c,d,f,e,k){d.ua="xdr";b.call(this,a,c,d,f,e,k)}var d=function(){},c=0,f={},B=window.XDomainRequest,r;n.inherits(b,C);b.isAvailable=g;var k=b.createRequest=function(a,c,d,f,k){var g=this&&this.timeouts?this.timeouts:h.TIMEOUTS;return r?new b(a,c,d,f,k,g):new e(a,c,d,f,k,g)};b.prototype.complete=function(a,b,c,d){this.requestComplete||(this.requestComplete=!0,b&&this.emit("data",b),this.emit("complete",
a,b,c,d),this.dispose())};b.prototype.abort=function(){this.dispose()};b.prototype.exec=function(){function a(){p=e.responseText;for(var b=p.length-1,c,d;q<b&&-1<(c=p.indexOf("\n",q));){d=p.slice(q,c);q=c+1;a:{try{d=JSON.parse(d)}catch(k){d=Error("Malformed response body from server: "+k.message);d.statusCode=400;g.complete(d);break a}g.emit("data",d)}}}function b(){a();g.streamComplete=!0;n.nextTick(function(){g.complete()})}var c=this.timer=setTimeout(function(){e.abort()},0==this.requestMode?this.timeouts.httpRequestTimeout:
this.timeouts.recvTimeout),d=this.body,f=d?"POST":"GET",k=this.headers,e=this.xhr=new XMLHttpRequest,g=this,h=k.accept,l="text";h?"application/json"!=h&&(l="arraybuffer"):k.accept="application/json";d&&"application/json"==(k["content-type"]||(k["content-type"]="application/json"))&&"string"!=typeof d&&(d=JSON.stringify(d));e.open(f,this.uri,!0);e.responseType=l;"authorization"in k&&(e.withCredentials="true");for(var u in k)e.setRequestHeader(u,k[u]);var m=e.onerror=function(a){a.code=8E4;g.complete(a)};
e.onabort=function(){var a=Error("Request cancelled");a.statusCode=400;m(a)};e.ontimeout=function(){var a=Error("Request timed out");a.statusCode=408;m(a)};var t,s,p,w,q=0,r=!1;e.onreadystatechange=function(){var d=e.readyState;if(!(3>d)&&0!==e.status){if(void 0===s)if(s=e.status,1223===s&&(s=204),clearTimeout(c),w=400>s,204==s)g.complete();else{var k;if(k=3==g.requestMode&&w)k=e,k=k.getResponseHeader&&k.getResponseHeader("transfer-encoding")&&!k.getResponseHeader("content-length");t=k}if(3==d&&t)a();
else if(4==d)if(t)b();else a:{try{var f=e.getResponseHeader&&e.getResponseHeader("content-type"),d=null,h=f?"application/json"==f:"text"==e.responseType;p=h?e.responseText:e.response;if(!p){204!=status&&(q=Error("Incomplete response body from server"),q.statusCode=400,g.complete(q));break a}h&&(p=JSON.parse(String(p)),r=!0);void 0!==p.response&&(s=p.statusCode,w=400>s,d=p.headers,p=p.response)}catch(l){var q=Error("Malformed response body from server: "+l.message);q.statusCode=400;g.complete(q);break a}w?
g.complete(null,p,d||f&&{"content-type":f},r):(q=p.error,q||(q=Error("Error response received from server: "+s),q.statusCode=s),g.complete(q))}}};e.send(d)};b.prototype.dispose=function(){var a=this.xhr;if(a){a.onreadystatechange=a.onerror=a.onabort=a.ontimeout=d;this.xhr=null;var b=this.timer;b&&(clearTimeout(b),this.timer=null);this.requestComplete||a.abort()}delete f[this.id]};n.inherits(e,b);e.prototype.exec=function(){function a(){clearTimeout(c);if(m=f.responseText){var b=m.length-1;if("\n"==
m[b]||(b=-1<m.indexOf("\n"))){var d=m.slice(0,b);try{var d=JSON.parse(d),e=d.error;if(e)u=e.statusCode||500,g.complete(e);else if(u=m?201:200,r=3==g.requestMode)t=b,n.isEmpty(d)||g.emit("data",d)}catch(k){e=Error("Malformed response body from server: "+k.message),e.statusCode=400,g.complete(e)}}}}function b(){m=f.responseText;for(var a=m.length-1,d,c;t<a&&-1<(d=m.indexOf("\n",t));){c=m.slice(t,d);t=d+1;a:{try{c=JSON.parse(c)}catch(e){c=Error("Malformed response body from server: "+e.message);c.statusCode=
400;g.complete(c);break a}g.emit("data",c)}}}function d(){b();g.streamComplete=!0;n.nextTick(function(){g.complete()})}var c=this.timer=setTimeout(function(){f.abort()},0==this.requestMode?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout),e=this.body,k=e?"POST":"GET",f=this.xhr=new XDomainRequest,g=this;e&&"object"==typeof e&&(e=JSON.stringify(e));var h=f.onerror=function(){l.logAction(l.LOG_ERROR,"Request.onerror()","");var a=Error("Error response");a.statusCode=400;a.code=8E4;g.complete(a)};
f.onabort=function(){l.logAction(l.LOG_ERROR,"Request.onabort()","");var a=Error("Request cancelled");a.statusCode=400;h(a)};f.ontimeout=function(){l.logAction(l.LOG_ERROR,"Request.timeout()","");var a=Error("Request timed out");a.statusCode=408;h(a)};var r,u,m,t=0;f.onprogress=function(){void 0===u?a():r&&b()};f.onload=function(){if(void 0===u&&(a(),g.requestComplete))return;if(r)d();else a:{try{m=f.responseText;if(!m||!m.length){204!=status&&(c=Error("Incomplete response body from server"),c.statusCode=
400,g.complete(c));break a}m=JSON.parse(String(m))}catch(b){var c=Error("Malformed response body from server: "+b.message);c.statusCode=400;g.complete(c);break a}g.complete(null,m,{"content-type":"application/json"},!0)}};try{f.open(k,this.uri),f.send(e)}catch(s){l.logAction(l.LOG_ERROR,"Request.onStreamEnd()","Unexpected send exception; err = "+s),h(s)}};e.prototype.dispose=function(){var a=this.xhr;if(a){a.onprogress=a.onload=a.onerror=a.onabort=a.ontimeout=d;this.xhr=null;var b=this.timer;b&&(clearTimeout(b),
this.timer=null);this.requestComplete||a.abort()}delete f[this.id]};if(g=b.isAvailable())A.addUnloadListener(a),"undefined"!==typeof Http&&(Http.supportsAuthHeaders=r,Http.Request=function(a,b,d,c,e){a=k(a,b,d,c,0);a.once("complete",e);a.exec();return a});return b}();(function(){function a(a){"string"!=typeof a&&(a=JSON.stringify(a));return a}function g(a){"string"==typeof a&&(a=JSON.parse(a));return a}function b(){this.stream="stream"in d?d.stream:!0;this.baseUri=this.sendUri=this.recvUri=this.pendingItems=
this.pendingCallback=this.recvRequest=this.sendRequest=null;var a=this;A.addMessageListener(window,function(b){a.onMessageEvent(b.data)})}var e=location.origin||location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),d=n.parseQueryString(window.location.search),c=d.origin;delete d.origin;var f="access_token"in d?{access_token:d.access_token}:{key:d.key},h=window.parent,r=x.Action;b.prototype.connect=function(){var a=(this.baseUri=e+"/comet/")+"connect",b=this;l.logAction(l.LOG_MINOR,
"IframeAgent.connect()","uri: "+a);a=this.recvRequest=y.createRequest(a,null,d,null,this.stream?3:1);a.on("data",function(a){null==b.sendUri&&b.checkConnectResponse(a);b.onData(a)});a.on("complete",function(a){b.recvRequest=null;a&&b.postErrorEvent(a)});a.exec()};b.prototype.dispose=function(){this.recvRequest&&(this.recvRequest.abort(),this.recvRequest=null)};b.prototype.checkConnectResponse=function(a){try{var b=g(a);if(b&&b.length)for(a=0;a<b.length;a++){var d=b[a];if(d.action==r.CONNECTED){this.onConnect(d);
break}}}catch(c){l.logAction(l.LOG_ERROR,"IframeAgent.checkConnectResponse()","Unexpected exception handing channel event: "+c)}};b.prototype.onConnect=function(a){a=this.baseUri+a.connectionKey;l.logAction(l.LOG_MICRO,"IframeAgent.onConnect()","baseUri = "+a);this.sendUri=a+"/send";this.recvUri=a+"/recv";var b=this;n.nextTick(function(){b.recv()})};b.prototype.onMessageEvent=function(a){var b=this;this.send(g(a),function(a,d){a?b.postErrorEvent(a):d&&b.postMessageEvent(d)})};b.prototype.send=function(a,
b){l.shouldLog(l.LOG_MICRO)&&l.logAction(l.LOG_MICRO,"IframeAgent.send()","msg = "+JSON.stringify(a));if(this.sendRequest)this.pendingItems=this.pendingItems||[],this.pendingItems.push(a),this.pendingCallback=this.pendingCallback||D(),this.pendingCallback.push(b);else{var d=this.pendingItems||[];d.push(a);this.pendingItems=null;var c=this.pendingCallback;c&&(c.push(b),b=c,this.pendingCallback=null);this.sendItems(d,b)}};b.prototype.sendItems=function(b,d){var c=this.sendUri,e=this;c?(c=this.sendRequest=
y.createRequest(c,null,f,a(b),0),c.on("complete",function(a,b){a&&l.logAction(l.LOG_ERROR,"IframeAgent.sendItems()","on complete: err = "+n.inspectError(a));e.sendRequest=null;if(b)e.onData(b);var c=e.pendingItems;if(c){e.pendingItems=null;var f=e.pendingCallback;e.pendingCallback=null;n.nextTick(function(){e.sendItems(c,f)})}d(a)}),c.exec()):d({message:"Unable to send; not connected",code:8E4,statusCode:400})};b.prototype.recv=function(){if(!this.recvRequest&&this.isConnected){var a=this,b=this.recvRequest=
y.createRequest(this.recvUri,null,f,null,a.stream?3:2);b.on("data",function(b){a.onData(b)});b.on("complete",function(b){a.recvRequest=null;b?a.postErrorEvent(b):n.nextTick(function(){a.recv()})});b.exec()}};b.prototype.onData=function(a){this.postMessageEvent(a)};b.prototype.postMessageEvent=function(b){h.postMessage(a(b),c)};b.prototype.postErrorEvent=function(a,b){var c=b;if(a){var d=new x.fromValues({action:r.ERROR,error:a});c&&n.mixin(d,c);c=d}this.postMessageEvent([c])};(new b).connect()})();
"undefined"!==typeof Realtime&&(z.Rest=Rest,z.Realtime=Realtime,Realtime.ConnectionManager=ConnectionManager,Realtime.BufferUtils=Rest.BufferUtils=BufferUtils,"undefined"!==typeof Crypto&&(Realtime.Crypto=Rest.Crypto=Crypto),Realtime.Defaults=Rest.Defaults=h,Realtime.Message=Rest.Message=Message,Realtime.PresenceMessage=Rest.PresenceMessage=PresenceMessage,Realtime.ProtocolMessage=Rest.ProtocolMessage=x)}).call({});

</script>
</head>
<body>
<h2>Ably cross-origin iframe</h2>
</body>
</html>
