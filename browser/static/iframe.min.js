(function(){var s,m,u,v,w;TAction={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15};TType={NONE:0,TRUE:1,FALSE:2,INT32:3,INT64:4,DOUBLE:5,STRING:6,BUFFER:7,JSONARRAY:8,JSONOBJECT:9};TFlags={SYNC_TIME:0};TPresenceState={ENTER:0,LEAVE:1,UPDATE:2};s=function(a){this.message=this.code=this.statusCode=void 0;a&&(void 0!==a.statusCode&&(this.statusCode=a.statusCode),void 0!==a.code&&(this.code=
a.code),void 0!==a.message&&(this.message=a.message))};s.prototype={};s.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.I16?this.statusCode=a.readI16():a.skip(b);break;case 2:b==Thrift.Type.I32?this.code=a.readI32():a.skip(b);break;case 3:b==Thrift.Type.STRING?this.message=a.readString():a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};s.prototype.write=function(a){a.writeStructBegin("TError");
void 0!==this.statusCode&&(a.writeFieldBegin("statusCode",Thrift.Type.I16,1),a.writeI16(this.statusCode),a.writeFieldEnd());void 0!==this.code&&(a.writeFieldBegin("code",Thrift.Type.I32,2),a.writeI32(this.code),a.writeFieldEnd());void 0!==this.message&&(a.writeFieldBegin("message",Thrift.Type.STRING,3),a.writeString(this.message),a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};m=function(a){this.cipherData=this.binaryData=this.stringData=this.doubleData=this.i64Data=this.i32Data=this.type=
void 0;a&&(void 0!==a.type&&(this.type=a.type),void 0!==a.i32Data&&(this.i32Data=a.i32Data),void 0!==a.i64Data&&(this.i64Data=a.i64Data),void 0!==a.doubleData&&(this.doubleData=a.doubleData),void 0!==a.stringData&&(this.stringData=a.stringData),void 0!==a.binaryData&&(this.binaryData=a.binaryData),void 0!==a.cipherData&&(this.cipherData=a.cipherData))};m.prototype={};m.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==
Thrift.Type.I32?this.type=a.readI32():a.skip(b);break;case 2:b==Thrift.Type.I32?this.i32Data=a.readI32():a.skip(b);break;case 3:b==Thrift.Type.I64?this.i64Data=a.readI64():a.skip(b);break;case 4:b==Thrift.Type.DOUBLE?this.doubleData=a.readDouble():a.skip(b);break;case 5:b==Thrift.Type.STRING?this.stringData=a.readString():a.skip(b);break;case 6:b==Thrift.Type.STRING?this.binaryData=a.readBinary():a.skip(b);break;case 7:b==Thrift.Type.STRING?this.cipherData=a.readBinary():a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};
m.prototype.write=function(a){a.writeStructBegin("TData");void 0!==this.type&&(a.writeFieldBegin("type",Thrift.Type.I32,1),a.writeI32(this.type),a.writeFieldEnd());void 0!==this.i32Data&&(a.writeFieldBegin("i32Data",Thrift.Type.I32,2),a.writeI32(this.i32Data),a.writeFieldEnd());void 0!==this.i64Data&&(a.writeFieldBegin("i64Data",Thrift.Type.I64,3),a.writeI64(this.i64Data),a.writeFieldEnd());void 0!==this.doubleData&&(a.writeFieldBegin("doubleData",Thrift.Type.DOUBLE,4),a.writeDouble(this.doubleData),
a.writeFieldEnd());void 0!==this.stringData&&(a.writeFieldBegin("stringData",Thrift.Type.STRING,5),a.writeString(this.stringData),a.writeFieldEnd());void 0!==this.binaryData&&(a.writeFieldBegin("binaryData",Thrift.Type.STRING,6),a.writeBinary(this.binaryData),a.writeFieldEnd());void 0!==this.cipherData&&(a.writeFieldBegin("cipherData",Thrift.Type.STRING,7),a.writeBinary(this.cipherData),a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};u=function(a){this.instanceId=this.connectionId=this.inheritMemberId=
this.memberId=this.clientData=this.clientId=this.state=void 0;a&&(void 0!==a.state&&(this.state=a.state),void 0!==a.clientId&&(this.clientId=a.clientId),void 0!==a.clientData&&(this.clientData=a.clientData),void 0!==a.memberId&&(this.memberId=a.memberId),void 0!==a.inheritMemberId&&(this.inheritMemberId=a.inheritMemberId),void 0!==a.connectionId&&(this.connectionId=a.connectionId),void 0!==a.instanceId&&(this.instanceId=a.instanceId))};u.prototype={};u.prototype.read=function(a){for(a.readStructBegin();;){var c=
a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.I32?this.state=a.readI32():a.skip(b);break;case 2:b==Thrift.Type.STRING?this.clientId=a.readString():a.skip(b);break;case 3:b==Thrift.Type.STRUCT?(this.clientData=new m,this.clientData.read(a)):a.skip(b);break;case 4:b==Thrift.Type.STRING?this.memberId=a.readString():a.skip(b);break;case 5:b==Thrift.Type.STRING?this.inheritMemberId=a.readString():a.skip(b);break;case 6:b==Thrift.Type.STRING?this.connectionId=
a.readString():a.skip(b);break;case 7:b==Thrift.Type.STRING?this.instanceId=a.readString():a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};u.prototype.write=function(a){a.writeStructBegin("TPresence");void 0!==this.state&&(a.writeFieldBegin("state",Thrift.Type.I32,1),a.writeI32(this.state),a.writeFieldEnd());void 0!==this.clientId&&(a.writeFieldBegin("clientId",Thrift.Type.STRING,2),a.writeString(this.clientId),a.writeFieldEnd());void 0!==this.clientData&&(a.writeFieldBegin("clientData",
Thrift.Type.STRUCT,3),this.clientData.write(a),a.writeFieldEnd());void 0!==this.memberId&&(a.writeFieldBegin("memberId",Thrift.Type.STRING,4),a.writeString(this.memberId),a.writeFieldEnd());void 0!==this.inheritMemberId&&(a.writeFieldBegin("inheritMemberId",Thrift.Type.STRING,5),a.writeString(this.inheritMemberId),a.writeFieldEnd());void 0!==this.connectionId&&(a.writeFieldBegin("connectionId",Thrift.Type.STRING,6),a.writeString(this.connectionId),a.writeFieldEnd());void 0!==this.instanceId&&(a.writeFieldBegin("instanceId",
Thrift.Type.STRING,7),a.writeString(this.instanceId),a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};TPresenceArray=function(a){this.items=void 0;a&&void 0!==a.items&&(this.items=a.items)};TPresenceArray.prototype={};TPresenceArray.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:if(b==Thrift.Type.LIST){c=0;this.items=[];c=a.readListBegin().size;for(b=0;b<c;++b){var e=null,e=new u;e.read(a);this.items.push(e)}a.readListEnd()}else a.skip(b);
break;case 0:a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};TPresenceArray.prototype.write=function(a){a.writeStructBegin("TPresenceArray");if(void 0!==this.items){a.writeFieldBegin("items",Thrift.Type.LIST,1);a.writeListBegin(Thrift.Type.STRUCT,this.items.length);for(var c in this.items)this.items.hasOwnProperty(c)&&(c=this.items[c],c.write(a));a.writeListEnd();a.writeFieldEnd()}a.writeFieldStop();a.writeStructEnd()};v=function(a){this.tags=this.data=this.timestamp=this.clientId=
this.name=void 0;a&&(void 0!==a.name&&(this.name=a.name),void 0!==a.clientId&&(this.clientId=a.clientId),void 0!==a.timestamp&&(this.timestamp=a.timestamp),void 0!==a.data&&(this.data=a.data),void 0!==a.tags&&(this.tags=a.tags))};v.prototype={};v.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.STRING?this.name=a.readString():a.skip(b);break;case 2:b==Thrift.Type.STRING?this.clientId=a.readString():
a.skip(b);break;case 3:b==Thrift.Type.I64?this.timestamp=a.readI64():a.skip(b);break;case 4:b==Thrift.Type.STRUCT?(this.data=new m,this.data.read(a)):a.skip(b);break;case 5:if(b==Thrift.Type.LIST){c=0;this.tags=[];c=a.readListBegin().size;for(b=0;b<c;++b){var e=null,e=a.readString();this.tags.push(e)}a.readListEnd()}else a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};v.prototype.write=function(a){a.writeStructBegin("TMessage");void 0!==this.name&&(a.writeFieldBegin("name",Thrift.Type.STRING,
1),a.writeString(this.name),a.writeFieldEnd());void 0!==this.clientId&&(a.writeFieldBegin("clientId",Thrift.Type.STRING,2),a.writeString(this.clientId),a.writeFieldEnd());void 0!==this.timestamp&&(a.writeFieldBegin("timestamp",Thrift.Type.I64,3),a.writeI64(this.timestamp),a.writeFieldEnd());void 0!==this.data&&(a.writeFieldBegin("data",Thrift.Type.STRUCT,4),this.data.write(a),a.writeFieldEnd());if(void 0!==this.tags){a.writeFieldBegin("tags",Thrift.Type.LIST,5);a.writeListBegin(Thrift.Type.STRING,
this.tags.length);for(var c in this.tags)this.tags.hasOwnProperty(c)&&(c=this.tags[c],a.writeString(c));a.writeListEnd();a.writeFieldEnd()}a.writeFieldStop();a.writeStructEnd()};TMessageArray=function(a){this.items=void 0;a&&void 0!==a.items&&(this.items=a.items)};TMessageArray.prototype={};TMessageArray.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:if(b==Thrift.Type.LIST){c=0;this.items=[];c=a.readListBegin().size;
for(b=0;b<c;++b){var e=null,e=new v;e.read(a);this.items.push(e)}a.readListEnd()}else a.skip(b);break;case 0:a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};TMessageArray.prototype.write=function(a){a.writeStructBegin("TMessageArray");if(void 0!==this.items){a.writeFieldBegin("items",Thrift.Type.LIST,1);a.writeListBegin(Thrift.Type.STRUCT,this.items.length);for(var c in this.items)this.items.hasOwnProperty(c)&&(c=this.items[c],c.write(a));a.writeListEnd();a.writeFieldEnd()}a.writeFieldStop();
a.writeStructEnd()};w=function(a){this.presence=this.messages=this.timestamp=this.msgSerial=this.channelSerial=this.channel=this.connectionSerial=this.connectionId=this.applicationId=this.error=this.count=this.flags=this.action=void 0;a&&(void 0!==a.action&&(this.action=a.action),void 0!==a.flags&&(this.flags=a.flags),void 0!==a.count&&(this.count=a.count),void 0!==a.error&&(this.error=a.error),void 0!==a.applicationId&&(this.applicationId=a.applicationId),void 0!==a.connectionId&&(this.connectionId=
a.connectionId),void 0!==a.connectionSerial&&(this.connectionSerial=a.connectionSerial),void 0!==a.channel&&(this.channel=a.channel),void 0!==a.channelSerial&&(this.channelSerial=a.channelSerial),void 0!==a.msgSerial&&(this.msgSerial=a.msgSerial),void 0!==a.timestamp&&(this.timestamp=a.timestamp),void 0!==a.messages&&(this.messages=a.messages),void 0!==a.presence&&(this.presence=a.presence))};w.prototype={};w.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;
if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.I32?this.action=a.readI32():a.skip(b);break;case 2:b==Thrift.Type.BYTE?this.flags=a.readByte():a.skip(b);break;case 3:b==Thrift.Type.I32?this.count=a.readI32():a.skip(b);break;case 4:b==Thrift.Type.STRUCT?(this.error=new s,this.error.read(a)):a.skip(b);break;case 5:b==Thrift.Type.STRING?this.applicationId=a.readString():a.skip(b);break;case 6:b==Thrift.Type.STRING?this.connectionId=a.readString():a.skip(b);break;case 7:b==Thrift.Type.I64?
this.connectionSerial=a.readI64():a.skip(b);break;case 8:b==Thrift.Type.STRING?this.channel=a.readString():a.skip(b);break;case 9:b==Thrift.Type.STRING?this.channelSerial=a.readString():a.skip(b);break;case 10:b==Thrift.Type.I64?this.msgSerial=a.readI64():a.skip(b);break;case 11:b==Thrift.Type.I64?this.timestamp=a.readI64():a.skip(b);break;case 12:if(b==Thrift.Type.LIST){c=0;this.messages=[];c=a.readListBegin().size;for(b=0;b<c;++b){var e=null,e=new v;e.read(a);this.messages.push(e)}a.readListEnd()}else a.skip(b);
break;case 13:if(b==Thrift.Type.LIST){c=0;this.presence=[];c=a.readListBegin().size;for(b=0;b<c;++b)e=null,e=new u,e.read(a),this.presence.push(e);a.readListEnd()}else a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};w.prototype.write=function(a){a.writeStructBegin("TProtocolMessage");void 0!==this.action&&(a.writeFieldBegin("action",Thrift.Type.I32,1),a.writeI32(this.action),a.writeFieldEnd());void 0!==this.flags&&(a.writeFieldBegin("flags",Thrift.Type.BYTE,2),a.writeByte(this.flags),
a.writeFieldEnd());void 0!==this.count&&(a.writeFieldBegin("count",Thrift.Type.I32,3),a.writeI32(this.count),a.writeFieldEnd());void 0!==this.error&&(a.writeFieldBegin("error",Thrift.Type.STRUCT,4),this.error.write(a),a.writeFieldEnd());void 0!==this.applicationId&&(a.writeFieldBegin("applicationId",Thrift.Type.STRING,5),a.writeString(this.applicationId),a.writeFieldEnd());void 0!==this.connectionId&&(a.writeFieldBegin("connectionId",Thrift.Type.STRING,6),a.writeString(this.connectionId),a.writeFieldEnd());
void 0!==this.connectionSerial&&(a.writeFieldBegin("connectionSerial",Thrift.Type.I64,7),a.writeI64(this.connectionSerial),a.writeFieldEnd());void 0!==this.channel&&(a.writeFieldBegin("channel",Thrift.Type.STRING,8),a.writeString(this.channel),a.writeFieldEnd());void 0!==this.channelSerial&&(a.writeFieldBegin("channelSerial",Thrift.Type.STRING,9),a.writeString(this.channelSerial),a.writeFieldEnd());void 0!==this.msgSerial&&(a.writeFieldBegin("msgSerial",Thrift.Type.I64,10),a.writeI64(this.msgSerial),
a.writeFieldEnd());void 0!==this.timestamp&&(a.writeFieldBegin("timestamp",Thrift.Type.I64,11),a.writeI64(this.timestamp),a.writeFieldEnd());if(void 0!==this.messages){a.writeFieldBegin("messages",Thrift.Type.LIST,12);a.writeListBegin(Thrift.Type.STRUCT,this.messages.length);for(var c in this.messages)this.messages.hasOwnProperty(c)&&(c=this.messages[c],c.write(a));a.writeListEnd();a.writeFieldEnd()}if(void 0!==this.presence){a.writeFieldBegin("presence",Thrift.Type.LIST,13);a.writeListBegin(Thrift.Type.STRUCT,
this.presence.length);for(var b in this.presence)this.presence.hasOwnProperty(b)&&(b=this.presence[b],b.write(a));a.writeListEnd();a.writeFieldEnd()}a.writeFieldStop();a.writeStructEnd()};TMessageBundle=function(a){this.items=void 0;a&&void 0!==a.items&&(this.items=a.items)};TMessageBundle.prototype={};TMessageBundle.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:if(b==Thrift.Type.LIST){c=0;this.items=[];c=
a.readListBegin().size;for(b=0;b<c;++b){var e=null,e=new w;e.read(a);this.items.push(e)}a.readListEnd()}else a.skip(b);break;case 0:a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};TMessageBundle.prototype.write=function(a){a.writeStructBegin("TMessageBundle");if(void 0!==this.items){a.writeFieldBegin("items",Thrift.Type.LIST,1);a.writeListBegin(Thrift.Type.STRUCT,this.items.length);for(var c in this.items)this.items.hasOwnProperty(c)&&(c=this.items[c],c.write(a));a.writeListEnd();
a.writeFieldEnd()}a.writeFieldStop();a.writeStructEnd()};SMessageCount=function(a){this.data=this.count=void 0;a&&(void 0!==a.count&&(this.count=a.count),void 0!==a.data&&(this.data=a.data))};SMessageCount.prototype={};SMessageCount.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.DOUBLE?this.count=a.readDouble():a.skip(b);break;case 2:b==Thrift.Type.DOUBLE?this.data=a.readDouble():a.skip(b);break;
default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};SMessageCount.prototype.write=function(a){a.writeStructBegin("SMessageCount");void 0!==this.count&&(a.writeFieldBegin("count",Thrift.Type.DOUBLE,1),a.writeDouble(this.count),a.writeFieldEnd());void 0!==this.data&&(a.writeFieldBegin("data",Thrift.Type.DOUBLE,2),a.writeDouble(this.data),a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};SMessageTypes=function(a){this.presence=this.messages=this.all=void 0;a&&(void 0!==a.all&&(this.all=a.all),
void 0!==a.messages&&(this.messages=a.messages),void 0!==a.presence&&(this.presence=a.presence))};SMessageTypes.prototype={};SMessageTypes.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.STRUCT?(this.all=new SMessageCount,this.all.read(a)):a.skip(b);break;case 2:b==Thrift.Type.STRUCT?(this.messages=new SMessageCount,this.messages.read(a)):a.skip(b);break;case 3:b==Thrift.Type.STRUCT?(this.presence=
new SMessageCount,this.presence.read(a)):a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};SMessageTypes.prototype.write=function(a){a.writeStructBegin("SMessageTypes");void 0!==this.all&&(a.writeFieldBegin("all",Thrift.Type.STRUCT,1),this.all.write(a),a.writeFieldEnd());void 0!==this.messages&&(a.writeFieldBegin("messages",Thrift.Type.STRUCT,2),this.messages.write(a),a.writeFieldEnd());void 0!==this.presence&&(a.writeFieldBegin("presence",Thrift.Type.STRUCT,3),this.presence.write(a),
a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};SResourceCount=function(a){this.sample_sum=this.sample_count=this.refused=this.min=this.mean=this.peak=this.opened=void 0;a&&(void 0!==a.opened&&(this.opened=a.opened),void 0!==a.peak&&(this.peak=a.peak),void 0!==a.mean&&(this.mean=a.mean),void 0!==a.min&&(this.min=a.min),void 0!==a.refused&&(this.refused=a.refused),void 0!==a.sample_count&&(this.sample_count=a.sample_count),void 0!==a.sample_sum&&(this.sample_sum=a.sample_sum))};SResourceCount.prototype=
{};SResourceCount.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.DOUBLE?this.opened=a.readDouble():a.skip(b);break;case 2:b==Thrift.Type.DOUBLE?this.peak=a.readDouble():a.skip(b);break;case 3:b==Thrift.Type.DOUBLE?this.mean=a.readDouble():a.skip(b);break;case 4:b==Thrift.Type.DOUBLE?this.min=a.readDouble():a.skip(b);break;case 5:b==Thrift.Type.DOUBLE?this.refused=a.readDouble():a.skip(b);break;
case 10:b==Thrift.Type.DOUBLE?this.sample_count=a.readDouble():a.skip(b);break;case 11:b==Thrift.Type.DOUBLE?this.sample_sum=a.readDouble():a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};SResourceCount.prototype.write=function(a){a.writeStructBegin("SResourceCount");void 0!==this.opened&&(a.writeFieldBegin("opened",Thrift.Type.DOUBLE,1),a.writeDouble(this.opened),a.writeFieldEnd());void 0!==this.peak&&(a.writeFieldBegin("peak",Thrift.Type.DOUBLE,2),a.writeDouble(this.peak),
a.writeFieldEnd());void 0!==this.mean&&(a.writeFieldBegin("mean",Thrift.Type.DOUBLE,3),a.writeDouble(this.mean),a.writeFieldEnd());void 0!==this.min&&(a.writeFieldBegin("min",Thrift.Type.DOUBLE,4),a.writeDouble(this.min),a.writeFieldEnd());void 0!==this.refused&&(a.writeFieldBegin("refused",Thrift.Type.DOUBLE,5),a.writeDouble(this.refused),a.writeFieldEnd());void 0!==this.sample_count&&(a.writeFieldBegin("sample_count",Thrift.Type.DOUBLE,10),a.writeDouble(this.sample_count),a.writeFieldEnd());void 0!==
this.sample_sum&&(a.writeFieldBegin("sample_sum",Thrift.Type.DOUBLE,11),a.writeDouble(this.sample_sum),a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};SConnectionTypes=function(a){this.tls=this.plain=this.all=void 0;a&&(void 0!==a.all&&(this.all=a.all),void 0!==a.plain&&(this.plain=a.plain),void 0!==a.tls&&(this.tls=a.tls))};SConnectionTypes.prototype={};SConnectionTypes.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;
switch(c.fid){case 1:b==Thrift.Type.STRUCT?(this.all=new SResourceCount,this.all.read(a)):a.skip(b);break;case 2:b==Thrift.Type.STRUCT?(this.plain=new SResourceCount,this.plain.read(a)):a.skip(b);break;case 3:b==Thrift.Type.STRUCT?(this.tls=new SResourceCount,this.tls.read(a)):a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};SConnectionTypes.prototype.write=function(a){a.writeStructBegin("SConnectionTypes");void 0!==this.all&&(a.writeFieldBegin("all",Thrift.Type.STRUCT,1),this.all.write(a),
a.writeFieldEnd());void 0!==this.plain&&(a.writeFieldBegin("plain",Thrift.Type.STRUCT,2),this.plain.write(a),a.writeFieldEnd());void 0!==this.tls&&(a.writeFieldBegin("tls",Thrift.Type.STRUCT,3),this.tls.write(a),a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};SMessageTraffic=function(a){this.httpStream=this.push=this.rest=this.realtime=this.all=void 0;a&&(void 0!==a.all&&(this.all=a.all),void 0!==a.realtime&&(this.realtime=a.realtime),void 0!==a.rest&&(this.rest=a.rest),void 0!==a.push&&
(this.push=a.push),void 0!==a.httpStream&&(this.httpStream=a.httpStream))};SMessageTraffic.prototype={};SMessageTraffic.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.STRUCT?(this.all=new SMessageTypes,this.all.read(a)):a.skip(b);break;case 2:b==Thrift.Type.STRUCT?(this.realtime=new SMessageTypes,this.realtime.read(a)):a.skip(b);break;case 3:b==Thrift.Type.STRUCT?(this.rest=new SMessageTypes,
this.rest.read(a)):a.skip(b);break;case 4:b==Thrift.Type.STRUCT?(this.push=new SMessageTypes,this.push.read(a)):a.skip(b);break;case 5:b==Thrift.Type.STRUCT?(this.httpStream=new SMessageTypes,this.httpStream.read(a)):a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};SMessageTraffic.prototype.write=function(a){a.writeStructBegin("SMessageTraffic");void 0!==this.all&&(a.writeFieldBegin("all",Thrift.Type.STRUCT,1),this.all.write(a),a.writeFieldEnd());void 0!==this.realtime&&(a.writeFieldBegin("realtime",
Thrift.Type.STRUCT,2),this.realtime.write(a),a.writeFieldEnd());void 0!==this.rest&&(a.writeFieldBegin("rest",Thrift.Type.STRUCT,3),this.rest.write(a),a.writeFieldEnd());void 0!==this.push&&(a.writeFieldBegin("push",Thrift.Type.STRUCT,4),this.push.write(a),a.writeFieldEnd());void 0!==this.httpStream&&(a.writeFieldBegin("httpStream",Thrift.Type.STRUCT,5),this.httpStream.write(a),a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};SRequestCount=function(a){this.refused=this.failed=this.succeeded=
void 0;a&&(void 0!==a.succeeded&&(this.succeeded=a.succeeded),void 0!==a.failed&&(this.failed=a.failed),void 0!==a.refused&&(this.refused=a.refused))};SRequestCount.prototype={};SRequestCount.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.DOUBLE?this.succeeded=a.readDouble():a.skip(b);break;case 2:b==Thrift.Type.DOUBLE?this.failed=a.readDouble():a.skip(b);break;case 3:b==Thrift.Type.DOUBLE?this.refused=
a.readDouble():a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};SRequestCount.prototype.write=function(a){a.writeStructBegin("SRequestCount");void 0!==this.succeeded&&(a.writeFieldBegin("succeeded",Thrift.Type.DOUBLE,1),a.writeDouble(this.succeeded),a.writeFieldEnd());void 0!==this.failed&&(a.writeFieldBegin("failed",Thrift.Type.DOUBLE,2),a.writeDouble(this.failed),a.writeFieldEnd());void 0!==this.refused&&(a.writeFieldBegin("refused",Thrift.Type.DOUBLE,3),a.writeDouble(this.refused),
a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};SStats=function(a){this.count=this.inProgress=this.tokenRequests=this.apiRequests=this.channels=this.connections=this.persisted=this.outbound=this.inbound=this.all=void 0;a&&(void 0!==a.all&&(this.all=a.all),void 0!==a.inbound&&(this.inbound=a.inbound),void 0!==a.outbound&&(this.outbound=a.outbound),void 0!==a.persisted&&(this.persisted=a.persisted),void 0!==a.connections&&(this.connections=a.connections),void 0!==a.channels&&(this.channels=
a.channels),void 0!==a.apiRequests&&(this.apiRequests=a.apiRequests),void 0!==a.tokenRequests&&(this.tokenRequests=a.tokenRequests),void 0!==a.inProgress&&(this.inProgress=a.inProgress),void 0!==a.count&&(this.count=a.count))};SStats.prototype={};SStats.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.STRUCT?(this.all=new SMessageTypes,this.all.read(a)):a.skip(b);break;case 2:b==Thrift.Type.STRUCT?
(this.inbound=new SMessageTraffic,this.inbound.read(a)):a.skip(b);break;case 3:b==Thrift.Type.STRUCT?(this.outbound=new SMessageTraffic,this.outbound.read(a)):a.skip(b);break;case 4:b==Thrift.Type.STRUCT?(this.persisted=new SMessageTypes,this.persisted.read(a)):a.skip(b);break;case 5:b==Thrift.Type.STRUCT?(this.connections=new SConnectionTypes,this.connections.read(a)):a.skip(b);break;case 6:b==Thrift.Type.STRUCT?(this.channels=new SResourceCount,this.channels.read(a)):a.skip(b);break;case 7:b==Thrift.Type.STRUCT?
(this.apiRequests=new SRequestCount,this.apiRequests.read(a)):a.skip(b);break;case 8:b==Thrift.Type.STRUCT?(this.tokenRequests=new SRequestCount,this.tokenRequests.read(a)):a.skip(b);break;case 10:b==Thrift.Type.STRING?this.inProgress=a.readString():a.skip(b);break;case 11:b==Thrift.Type.I32?this.count=a.readI32():a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};SStats.prototype.write=function(a){a.writeStructBegin("SStats");void 0!==this.all&&(a.writeFieldBegin("all",Thrift.Type.STRUCT,
1),this.all.write(a),a.writeFieldEnd());void 0!==this.inbound&&(a.writeFieldBegin("inbound",Thrift.Type.STRUCT,2),this.inbound.write(a),a.writeFieldEnd());void 0!==this.outbound&&(a.writeFieldBegin("outbound",Thrift.Type.STRUCT,3),this.outbound.write(a),a.writeFieldEnd());void 0!==this.persisted&&(a.writeFieldBegin("persisted",Thrift.Type.STRUCT,4),this.persisted.write(a),a.writeFieldEnd());void 0!==this.connections&&(a.writeFieldBegin("connections",Thrift.Type.STRUCT,5),this.connections.write(a),
a.writeFieldEnd());void 0!==this.channels&&(a.writeFieldBegin("channels",Thrift.Type.STRUCT,6),this.channels.write(a),a.writeFieldEnd());void 0!==this.apiRequests&&(a.writeFieldBegin("apiRequests",Thrift.Type.STRUCT,7),this.apiRequests.write(a),a.writeFieldEnd());void 0!==this.tokenRequests&&(a.writeFieldBegin("tokenRequests",Thrift.Type.STRUCT,8),this.tokenRequests.write(a),a.writeFieldEnd());void 0!==this.inProgress&&(a.writeFieldBegin("inProgress",Thrift.Type.STRING,10),a.writeString(this.inProgress),
a.writeFieldEnd());void 0!==this.count&&(a.writeFieldBegin("count",Thrift.Type.I32,11),a.writeI32(this.count),a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};SStatsArray=function(a){this.items=void 0;a&&void 0!==a.items&&(this.items=a.items)};SStatsArray.prototype={};SStatsArray.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:if(b==Thrift.Type.LIST){c=0;this.items=[];c=a.readListBegin().size;for(b=
0;b<c;++b){var e=null,e=new SStats;e.read(a);this.items.push(e)}a.readListEnd()}else a.skip(b);break;case 0:a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};SStatsArray.prototype.write=function(a){a.writeStructBegin("SStatsArray");if(void 0!==this.items){a.writeFieldBegin("items",Thrift.Type.LIST,1);a.writeListBegin(Thrift.Type.STRUCT,this.items.length);for(var c in this.items)this.items.hasOwnProperty(c)&&(c=this.items[c],c.write(a));a.writeListEnd();a.writeFieldEnd()}a.writeFieldStop();
a.writeStructEnd()};WWebhookMessage=function(a){this.data=this.serial=this.timestamp=this.webhookId=this.name=void 0;a&&(void 0!==a.name&&(this.name=a.name),void 0!==a.webhookId&&(this.webhookId=a.webhookId),void 0!==a.timestamp&&(this.timestamp=a.timestamp),void 0!==a.serial&&(this.serial=a.serial),void 0!==a.data&&(this.data=a.data))};WWebhookMessage.prototype={};WWebhookMessage.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;
switch(c.fid){case 1:b==Thrift.Type.STRING?this.name=a.readString():a.skip(b);break;case 2:b==Thrift.Type.STRING?this.webhookId=a.readString():a.skip(b);break;case 3:b==Thrift.Type.I64?this.timestamp=a.readI64():a.skip(b);break;case 4:b==Thrift.Type.STRING?this.serial=a.readString():a.skip(b);break;case 5:b==Thrift.Type.STRUCT?(this.data=new m,this.data.read(a)):a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};WWebhookMessage.prototype.write=function(a){a.writeStructBegin("WWebhookMessage");
void 0!==this.name&&(a.writeFieldBegin("name",Thrift.Type.STRING,1),a.writeString(this.name),a.writeFieldEnd());void 0!==this.webhookId&&(a.writeFieldBegin("webhookId",Thrift.Type.STRING,2),a.writeString(this.webhookId),a.writeFieldEnd());void 0!==this.timestamp&&(a.writeFieldBegin("timestamp",Thrift.Type.I64,3),a.writeI64(this.timestamp),a.writeFieldEnd());void 0!==this.serial&&(a.writeFieldBegin("serial",Thrift.Type.STRING,4),a.writeString(this.serial),a.writeFieldEnd());void 0!==this.data&&(a.writeFieldBegin("data",
Thrift.Type.STRUCT,5),this.data.write(a),a.writeFieldEnd());a.writeFieldStop();a.writeStructEnd()};WWebhookEnvelope=function(a){this.items=this.error=void 0;a&&(void 0!==a.error&&(this.error=a.error),void 0!==a.items&&(this.items=a.items))};WWebhookEnvelope.prototype={};WWebhookEnvelope.prototype.read=function(a){for(a.readStructBegin();;){var c=a.readFieldBegin(),b=c.ftype;if(b==Thrift.Type.STOP)break;switch(c.fid){case 1:b==Thrift.Type.STRUCT?(this.error=new s,this.error.read(a)):a.skip(b);break;
case 2:if(b==Thrift.Type.LIST){c=0;this.items=[];c=a.readListBegin().size;for(b=0;b<c;++b){var e=null,e=new WWebhookMessage;e.read(a);this.items.push(e)}a.readListEnd()}else a.skip(b);break;default:a.skip(b)}a.readFieldEnd()}a.readStructEnd()};WWebhookEnvelope.prototype.write=function(a){a.writeStructBegin("WWebhookEnvelope");void 0!==this.error&&(a.writeFieldBegin("error",Thrift.Type.STRUCT,1),this.error.write(a),a.writeFieldEnd());if(void 0!==this.items){a.writeFieldBegin("items",Thrift.Type.LIST,
2);a.writeListBegin(Thrift.Type.STRUCT,this.items.length);for(var c in this.items)this.items.hasOwnProperty(c)&&(c=this.items[c],c.write(a));a.writeListEnd();a.writeFieldEnd()}a.writeFieldStop();a.writeStructEnd()};var z=TAction,A=function(){function a(){this.any=[];this.events={};this.anyOnce=[];this.eventsOnce={}}a.prototype.on=function(a,b){1==arguments.length&&"function"==typeof a?this.any.push(a):null===a?this.any.push(b):(this.events[a]=this.events[a]||[]).push(b)};a.prototype.off=function(a,
b){if(0==arguments.length)this.any=[],this.events={},this.anyOnce=[],this.eventsOnce={};else{1==arguments.length&&"function"==typeof a&&(b=a,a=null);var e,d=-1;if(null===a)if(b){if(!(e=this.any)||-1==(d=q.arrIndexOf(e,b)))if(e=this.anyOnce)d=q.arrIndexOf(e,b);-1<d&&e.splice(d,1)}else this.any=[],this.anyOnce=[];else if(b){d=-1;if(!(e=this.events[a])||-1==(d=q.arrIndexOf(e,b)))if(e=this.eventsOnce[a])d=q.arrIndexOf(e,b);-1<d&&e.splice(d,1)}else delete this.events[a],delete this.eventsOnce[a]}};a.prototype.listeners=
function(a){if(a){var b=this.events[a]||[];this.eventsOnce[a]&&Array.prototype.push.apply(b,this.eventsOnce[a]);return b.length?b:null}return this.any.length?this.any:null};a.prototype.emit=function(a){function b(a){try{a.apply(d,e)}catch(b){n.logAction(n.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+b+"; stack = "+b.stack)}}var e=Array.prototype.slice.call(arguments,1),d={event:a};if(this.anyOnce.length){var f=this.anyOnce;this.anyOnce=[];for(var h=0;h<f.length;h++)b(f[h])}for(h=
0;h<this.any.length;h++)this.any[h].apply(d,e);if(f=this.eventsOnce[a])for(delete this.eventsOnce[a],h=0;h<f.length;h++)b(f[h]);if(f=this.events[a])for(h=0;h<f.length;h++)b(f[h])};a.prototype.once=function(a,b){1==arguments.length&&"function"==typeof a?this.anyOnce.push(a):null===a?this.anyOnce.push(b):(this.eventsOnce[a]=this.eventsOnce[a]||[]).push(b)};return a}(),n=function(){function a(a){}var c=4,b=function(){};a.LOG_NONE=0;a.LOG_ERROR=1;a.LOG_MAJOR=2;a.LOG_MINOR=3;a.LOG_MICRO=4;a.LOG_DEFAULT=
3;a.LOG_DEBUG=4;a.logAction=function(a,d,f){a<=c&&b("Ably: "+d+": "+f)};a.setLog=function(a,d){c=a||3;b=d||function(a){console.log(a)}};return a}(),C=function(){return function(a){a=a||[];var c=function(){for(var b=0;b<a.length;b++){var c=a[b];try{c.apply(null,arguments)}catch(d){}}};c.push=function(){Array.prototype.push.apply(a,arguments)};return c}}(),q=function(){function a(){}var c="object"==typeof window;a.addProperties=a.mixin=function(a,c){for(var d in c)a[d]=c[d];return a};a.copy=function(b){return a.mixin({},
b)};a.isArray=function(a){return"[object Array]"==Object.prototype.toString.call(a)};a.isEmpty=function(a){for(var c in a)return!1;return!0};a.shallowClone=function(a){var c={},d;for(d in a)c[d]=a[d];return c};a.prototypicalClone=function(b,c){function d(){}d.prototype=b;var f=new d;c&&a.mixin(f,c);return f};a.inherits="undefined"!==typeof require&&require("util").inherits||function(b,c){b.super_=c;b.prototype=a.prototypicalClone(c.prototype,{constructor:b})};a.containsValue=function(a,c){for(var d in a)if(a[d]==
c)return!0;return!1};a.intersect=function(b,c){return a.isArray(c)?a.arrIntersect(b,c):a.arrIntersectOb(b,c)};a.isArray=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};a.arrIntersect=function(b,c){for(var d=[],f=0;f<b.length;f++){var h=b[f];-1!=a.arrIndexOf(c,h)&&d.push(h)}return d};a.arrIntersectOb=function(a,c){for(var d=[],f=0;f<a.length;f++){var h=a[f];h in c&&d.push(h)}return d};a.arrSubtract=function(b,c){for(var d=[],f=0;f<b.length;f++){var h=
b[f];-1==a.arrIndexOf(c,h)&&d.push(h)}return d};a.arrIndexOf=Array.prototype.indexOf?function(a,c,d){return a.indexOf(c,d)}:function(a,c,d){d=d||0;for(var f=a.length;d<f;d++)if(a[d]===c)return d;return-1};a.keysArray=function(a,c){var d=[],f;for(f in a)c&&!a.hasOwnProperty(f)||d.push(f);return d.length?d:void 0};a.valuesArray=function(a,c){var d=[],f;for(f in a)c&&!a.hasOwnProperty(f)||d.push(a[f]);return d.length?d:void 0};a.nextTick=c?function(a){setTimeout(a,0)}:process.nextTick;a.defaultGetHeaders=
function(a){return{accept:a?"application/x-thrift,application/json":"application/json"}};a.defaultPostHeaders=function(a){return{accept:a?"application/x-thrift,application/json":"application/json","content-type":a?"application/x-thrift":"application/json"}};a.arrRandomElement=function(a){return a.splice(Math.floor(Math.random()*a.length))};a.toQueryString=function(a){var c=[];if(a)for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.length?"?"+c.join("&"):""};a.parseQueryString=
function(a){for(var c,d=/([^?&=]+)=?([^&]*)/g,f={};c=d.exec(a);)f[decodeURIComponent(c[1])]=decodeURIComponent(c[2]);return f};return a}(),r={protocolVersion:1,HOST:"rest.ably.io",WS_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,connectTimeout:15E3,disconnectTimeout:3E4,suspendedTimeout:12E4,recvTimeout:9E4,sendTimeout:1E4,connectionPersistTimeout:15E3,httpTransports:["xhr",
"iframe","jsonp"],transports:["web_socket","flash_socket","xhr","iframe","jsonp"],flashTransport:{swfLocation:("undefined"!==typeof window?window.location.protocol:"https:")+"//cdn.ably.io/lib/swf/WebSocketMainInsecure-0.9.swf"},getHost:function(a,c,b){c=c||a.host||r.HOST;b&&(c=c==a.host&&(a.wsHost||c)||c==r.HOST&&(r.WS_HOST||c)||c);return c},getPort:function(a,c){return c||a.tls?a.tlsPort||r.TLS_PORT:a.port||r.PORT},getHosts:function(a){var c;a.host?(c=[a.host],a.fallbackHosts&&c.concat(a.fallbackHosts)):
c=[r.HOST].concat(r.FALLBACK_HOSTS);return c}};"undefined"!==typeof exports&&this.exports!==exports&&(exports.defaults=r);var B=function(){function a(){}a.addListener=function(a,b,e){a.addEventListener?a.addEventListener(b,e,!1):a.attachEvent("on"+b,e)};a.removeListener=function(a,b,e){a.removeEventListener?a.removeEventListener(b,e,!1):a.detachEvent("on"+b,e)};a.addMessageListener=function(c,b){a.addListener(c,"message",b)};a.removeMessageListener=function(c,b){a.removeListener(c,"message",b)};a.addUnloadListener=
function(c){a.addListener(window,"unload",c)};return a}(),y=function(){function a(){for(var a in m)m[a].dispose()}function c(){return window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?k=!0:g&&document.domain&&"https:"==window.location.protocol?!0:!1}function b(a){var b={};a.getResponseHeader&&(a=a.getResponseHeader("Content-Type"))&&(b["Content-Type"]=a);return b}function e(a,b,c,d,e){A.call(this);c=c||{};c.rnd=String(Math.random()).substr(2);this.uri=a+q.toQueryString(c);this.headers=
b||{};this.body=d;this.requestMode=e;this.requestComplete=!1;m[this.id=String(++h)]=this}function d(a,b,c,d,g){c.ua="xdr";e.call(this,a,b,c,d,g)}var f=function(){},h=0,m={},g=window.XDomainRequest,k;q.inherits(e,A);e.isAvailable=c;var t=e.createRequest=function(a,b,c,g,f){return k?new e(a,b,c,g,f):new d(a,b,c,g,f)};e.prototype.complete=function(a,c){if(!this.requestComplete){this.requestComplete=!0;var d=this.xhr;c&&this.emit("data",c);this.emit("complete",a,c,d&&b(d));this.dispose()}};e.prototype.abort=
function(){this.dispose()};e.prototype.exec=function(){function a(){p=f.responseText;for(var b=p.length-1,c,d;x<b&&-1<(c=p.indexOf("\n",x));){d=p.slice(x,c);x=c+1;a:{try{d=JSON.parse(d)}catch(e){err=Error("Malformed response body from server: "+e.message);err.statusCode=400;k.complete(err);break a}k.emit("data",d)}}}function b(){a();k.streamComplete=!0;q.nextTick(function(){k.complete()})}var c=this.timer=setTimeout(function(){f.abort()},0==this.requestMode?r.sendTimeout:r.recvTimeout),d=this.body,
e=d?"POST":"GET",g=this.headers,f=this.xhr=new XMLHttpRequest,k=this;g.accept=g.accept||"application/json";d&&("object"==typeof d&&(d=JSON.stringify(d)),g["content-type"]=g["content-type"]||"application/json");f.open(e,this.uri,!0);f.withCredentials="true";for(var t in g)f.setRequestHeader(t,g[t]);var h=f.onerror=function(a){a.code=8E4;k.complete(a)};f.onabort=function(){var a=Error("Request cancelled");a.statusCode=400;h(a)};f.ontimeout=function(){var a=Error("Request timed out");a.statusCode=408;
h(a)};var n,l,p,m,x=0;f.onreadystatechange=function(){var d=f.readyState;if(!(3>d)&&0!==f.status)if(void 0===l&&(l=f.status,1223===l&&(l=204),clearTimeout(c),m=400>l,204==l?k.complete():n=3==k.requestMode&&m),3==d&&n)a();else if(4==d)if(n)b();else a:{try{p=f.responseText;if(!p||!p.length){204!=status&&(g=Error("Incomplete response body from server"),g.statusCode=400,k.complete(g));break a}p=JSON.parse(String(p))}catch(e){var g=Error("Malformed response body from server: "+e.message);g.statusCode=
400;k.complete(g);break a}m?k.complete(null,p):(g=p.error,g||(g=Error("Error response received from server: "+l),g.statusCode=l),k.complete(g))}};f.send(d)};e.prototype.dispose=function(){var a=this.xhr;if(a){a.onreadystatechange=a.onerror=a.onabort=a.ontimeout=f;this.xhr=null;var b=this.timer;b&&(clearTimeout(b),this.timer=null);this.requestComplete||a.abort()}delete m[this.id]};q.inherits(d,e);d.prototype.exec=function(){function a(){clearTimeout(d);if(l=f.responseText){var b=l.length-1;if("\n"==
l[b]||(b=-1<l.indexOf("\n"))){var c=l.slice(0,b);try{var c=JSON.parse(c),g=c.error;if(g)m=g.statusCode||500,k.complete(g);else if(m=l?201:200,h=3==k.requestMode)p=b,q.isEmpty(c)||k.emit("data",c)}catch(e){g=Error("Malformed response body from server: "+e.message),g.statusCode=400,k.complete(g)}}}}function b(){l=f.responseText;for(var a=l.length-1,c,d;p<a&&-1<(c=l.indexOf("\n",p));){d=l.slice(p,c);p=c+1;a:{try{d=JSON.parse(d)}catch(g){err=Error("Malformed response body from server: "+g.message);err.statusCode=
400;k.complete(err);break a}k.emit("data",d)}}}function c(){b();k.streamComplete=!0;q.nextTick(function(){k.complete()})}var d=this.timer=setTimeout(function(){f.abort()},0==this.requestMode?r.sendTimeout:r.recvTimeout),g=this.body,e=g?"POST":"GET",f=this.xhr=new XDomainRequest,k=this;g&&"object"==typeof g&&(g=JSON.stringify(g));var t=f.onerror=function(){n.logAction(n.LOG_ERROR,"Request.onerror()","");var a=Error("Error response");a.statusCode=400;a.code=8E4;k.complete(a)};f.onabort=function(){n.logAction(n.LOG_ERROR,
"Request.onabort()","");var a=Error("Request cancelled");a.statusCode=400;t(a)};f.ontimeout=function(){n.logAction(n.LOG_ERROR,"Request.timeout()","");var a=Error("Request timed out");a.statusCode=408;t(a)};var h,m,l,p=0;f.onprogress=function(){void 0===m?a():h&&b()};f.onload=function(){if(void 0===m&&(a(),k.requestComplete))return;if(h)c();else a:{try{l=f.responseText;if(!l||!l.length){204!=status&&(d=Error("Incomplete response body from server"),d.statusCode=400,k.complete(d));break a}l=JSON.parse(String(l))}catch(b){var d=
Error("Malformed response body from server: "+b.message);d.statusCode=400;k.complete(d);break a}k.complete(null,l)}};try{f.open(e,this.uri),f.send(g)}catch(s){n.logAction(n.LOG_ERROR,"Request.onStreamEnd()","Unexpected send exception; err = "+s),t(s)}};d.prototype.dispose=function(){var a=this.xhr;if(a){a.onprogress=a.onload=a.onerror=a.onabort=a.ontimeout=f;this.xhr=null;var b=this.timer;b&&(clearTimeout(b),this.timer=null);this.requestComplete||a.abort()}delete m[this.id]};if(c=e.isAvailable())B.addUnloadListener(a),
"undefined"!==typeof Http&&(Http.supportsAuthHeaders=k,Http.Request=function(a,b,c,d,g,e){a=t(a,b,c,d,0);a.once("complete",e);a.exec();return a});return e}();(function(){function a(a){"string"!=typeof a&&(a=JSON.stringify(a));return a}function c(a){"string"==typeof a&&(a=JSON.parse(a));return a}function b(){this.stream="stream"in d?d.stream:!0;this.baseUri=this.sendUri=this.recvUri=this.pendingItems=this.pendingCallback=this.recvRequest=this.sendRequest=null;var a=this;B.addMessageListener(window,
function(b){a.onMessageEvent(b.data)})}var e=location.origin||location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),d=q.parseQueryString(window.location.search),f=d.origin;delete d.origin;var h="access_token"in d?{access_token:d.access_token}:{key_id:d.key_id,key_value:d.key_value},m=window.parent;b.prototype.connect=function(){var a=(this.baseUri=e+"/comet/")+"connect",b=this;n.logAction(n.LOG_MINOR,"IframeAgent.connect()","uri: "+a);a=this.recvRequest=y.createRequest(a,null,
d,null,this.stream?3:1);a.on("data",function(a){null==b.sendUri&&b.checkConnectResponse(a);b.onData(a)});a.on("complete",function(a){b.recvRequest=null;a&&b.postErrorEvent(a)});a.exec()};b.prototype.dispose=function(){this.recvRequest&&(this.recvRequest.abort(),this.recvRequest=null)};b.prototype.checkConnectResponse=function(a){try{var b=c(a);if(b&&b.length)for(a=0;a<b.length;a++){var d=b[a];if(d.action==z.CONNECTED){this.onConnect(d);break}}}catch(e){n.logAction(n.LOG_ERROR,"IframeAgent.checkConnectResponse()",
"Unexpected exception handing channel event: "+e)}};b.prototype.onConnect=function(a){a=this.baseUri+a.connectionId;n.logAction(n.LOG_MICRO,"IframeAgent.onConnect()","baseUri = "+a);this.sendUri=a+"/send";this.recvUri=a+"/recv";var b=this;q.nextTick(function(){b.recv()})};b.prototype.onMessageEvent=function(a){var b=this;this.send(c(a),function(a,c){a?b.postErrorEvent(a):c&&b.postMessageEvent(c)})};b.prototype.send=function(a,b){n.logAction(n.LOG_MICRO,"IframeAgent.send()","msg = "+JSON.stringify(a));
if(this.sendRequest)this.pendingItems=this.pendingItems||[],this.pendingItems.push(a),this.pendingCallback=this.pendingCallback||C(),this.pendingCallback.push(b);else{var c=this.pendingItems||[];c.push(a);this.pendingItems=null;var d=this.pendingCallback;d&&(d.push(b),b=d,this.pendingCallback=null);this.sendItems(c,b)}};b.prototype.sendItems=function(b,c){var d=this.sendUri,e=this;d?(d=this.sendRequest=y.createRequest(d,null,h,a(b),0),d.on("complete",function(a,b){a&&n.logAction(n.LOG_ERROR,"IframeAgent.sendItems()",
"on complete: err = "+a);e.sendRequest=null;if(b)e.onData(b);var d=e.pendingItems;if(d){e.pendingItems=null;var f=e.pendingCallback;e.pendingCallback=null;q.nextTick(function(){e.sendItems(d,f)})}c(a)}),d.exec()):c({message:"Unable to send; not connected",code:8E4,statusCode:400})};b.prototype.recv=function(){if(!this.recvRequest&&this.isConnected){var a=this,b=this.recvRequest=y.createRequest(this.recvUri,null,h,null,a.stream?3:2);b.on("data",function(b){a.onData(b)});b.on("complete",function(b){a.recvRequest=
null;b?a.postErrorEvent(b):q.nextTick(function(){a.recv()})});b.exec()}};b.prototype.onData=function(a){this.postMessageEvent(a)};b.prototype.postMessageEvent=function(b){m.postMessage(a(b),f)};b.prototype.postErrorEvent=function(a,b){var c=b;if(a){var d=new w({action:z.ERROR,error:a});c&&q.mixin(d,c);c=d}this.postMessageEvent([c])};(new b).connect()})()})();
